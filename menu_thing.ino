#include <U8g2lib.h>

#define SELECT_PIN 2
#define UP_PIN 3
#define DN_PIN 4

// 'item_sel_background', 128x21px
const unsigned char bitmap_item_sel_background[] PROGMEM = {
  0xf8, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x01,
  0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02,
  0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04,
  0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
  0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
  0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
  0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
  0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
  0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
  0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
  0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
  0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
  0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
  0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
  0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
  0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
  0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
  0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c,
  0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06,
  0xf8, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x03,
  0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x01
};

// 'scroll_bar', 8x64px
const unsigned char bitmap_scroll_bar[] PROGMEM = {
  0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40,
  0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40,
  0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40,
  0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x40, 0x00, 0x00
};

// 'icon_next', 16x16px
const unsigned char bitmap_icon_next[] PROGMEM = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x30, 0x14, 0x28, 0x24, 0x24, 0x48, 0x12,
  0x90, 0x09, 0x20, 0x04, 0x40, 0x02, 0x80, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

// 'icon_prev', 16x16px
const unsigned char bitmap_icon_prev[] PROGMEM = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x01, 0x40, 0x02, 0x20, 0x04, 0x90, 0x09,
  0x48, 0x12, 0x24, 0x24, 0x14, 0x28, 0x0c, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

// 'icon_selected', 16x16px
const unsigned char bitmap_icon_selected[] PROGMEM = {
  0x00, 0x00, 0x00, 0x00, 0xe0, 0x07, 0x10, 0x08, 0xc8, 0x13, 0x24, 0x24, 0x94, 0x29, 0x54, 0x2a,
  0x54, 0x2a, 0x94, 0x29, 0x24, 0x24, 0xc8, 0x13, 0x10, 0x08, 0xe0, 0x07, 0x00, 0x00, 0x00, 0x00
};

const int NUM_ITEMS = 10;

// Array of all bitmap icons for convenience.
const unsigned char* item_icons[NUM_ITEMS] = {
  bitmap_icon_prev,
  bitmap_icon_selected,
  bitmap_icon_next,
  bitmap_icon_selected,
  bitmap_icon_selected,
  bitmap_icon_selected,
  bitmap_icon_selected,
  bitmap_icon_selected,
  bitmap_icon_selected,
  bitmap_icon_selected
};

char item_titles[NUM_ITEMS][20] = {
  { "Item #0" },
  { "Item #1" },
  { "Item #2" },
  { "Item #3" },
  { "Item #4" },
  { "Item #5" },
  { "Item #6" },
  { "Item #7" },
  { "Item #8" },
  { "Item #9" }
};

int item_sel_prev = 0;
int item_sel_curr = 1;
int item_sel_next = 2;

int scroll_handle_height = 64 / NUM_ITEMS;

U8G2_SSD1306_128X64_NONAME_1_HW_I2C u8g2(U8G2_R0);

void setup() {
  Serial.begin(19200);

  pinMode(UP_PIN, INPUT_PULLUP);
  pinMode(DN_PIN, INPUT_PULLUP);
  pinMode(SELECT_PIN, INPUT_PULLUP);

  u8g2.setBitmapMode(1);
  u8g2.begin();
}

void loop() {
  if (digitalRead(SELECT_PIN) == LOW) {
    Serial.println("Enter!");
  }

  if (digitalRead(UP_PIN) == LOW) {
    if (--item_sel_curr < 0) {
      item_sel_curr = NUM_ITEMS - 1;
    }
  } else if (digitalRead(DN_PIN) == LOW) {
    if (++item_sel_curr >= NUM_ITEMS) {
      item_sel_curr = 0;
    }
  }

  item_sel_prev = item_sel_curr - 1;
  if (item_sel_prev < 0) {
    item_sel_prev = NUM_ITEMS - 1;
  }

  item_sel_next = item_sel_curr + 1;
  if (item_sel_next >= NUM_ITEMS) {
    item_sel_next = 0;
  }

  int scroll_percentage = map(item_sel_curr, 0, NUM_ITEMS, 0, 100);

  u8g2.firstPage();
  do {
    // Prev Item
    u8g2.drawXBMP(4, 2, 16, 16, item_icons[item_sel_prev]);
    u8g2.setFont(u8g2_font_7x14_mf);
    u8g2.drawStr(26, 15, item_titles[item_sel_prev]);

    // Selected Item
    u8g2.drawXBMP(4, 24, 16, 16, item_icons[item_sel_curr]);
    u8g2.setFont(u8g2_font_7x14B_mf);
    u8g2.drawStr(26, 37, item_titles[item_sel_curr]);

    u8g2.drawXBMP(0, 22, 128, 21, bitmap_item_sel_background);

    // Next Item
    u8g2.drawXBMP(4, 46, 16, 16, item_icons[item_sel_next]);
    u8g2.setFont(u8g2_font_7x14_mf);
    u8g2.drawStr(26, 59, item_titles[item_sel_next]);

    // Scroll Bar
    u8g2.drawXBMP(120, 0, 8, 64, bitmap_scroll_bar);

    // Scroll Handle
    u8g2.drawBox(125, getScrollPixel(scroll_percentage), 3, scroll_handle_height);
  } while (u8g2.nextPage());
}

int getScrollPixel(int val) {
  return map(val, 0, 100, 0, 64);
}
